<!-- your_template.html -->
{% extends "basic.html" %}
{% load static %}
{% block head %}

<title>Posts</title>
<style>
    .reply-container {
        margin-left: 20px;
    }
</style>
{% endblock %}
{% block body %}

<h1>HealthConnect Feed</h1>
{% for post in all_posts %}
<div>
    <p>{{ post.post_header }}</p>
    <p>{{ post.post_text }}</p>
    <p>Posted by: {{ post.user.username }} | {{ post.created_at }}</p>

    {% if post.replies.all %}
    <div class="reply-container">
        <p><strong>Replies:</strong></p>
        {% for reply in post.replies.all %}
        <p>{{ reply.content }} - {{ reply.user.username }} | {{ reply.created_at }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <button onclick="toggleReplies('{{ post.id }}')">Show/Hide Replies</button>
</div>
<hr>
{% endfor %}

<!-- Form for creating a new post -->
<form method="post" action="{% url 'recent_post' %}">
    {% csrf_token %}
    <label for="new-post">New Post:</label>
    <textarea id="new-post" name="new_post_content" required></textarea>
    <br>
    <button id="sendpost" type="submit">Create Post</button>
</form>

<!-- Form for replying to a post -->
<form method="post" action="{% url 'create_reply' %}">
    {% csrf_token %}
    <label for="reply-post-id">Reply to Post ID:</label>
    <input type="number" id="reply-post-id" name="post_id" required>
    <br>
    <label for="reply-content">Reply Content:</label>
    <textarea id="reply-content" name="reply_content" required></textarea>
    <br>
    <button type="submit">Reply</button>
</form>

<script>
    function toggleReplies(postId) {
        var repliesContainer = document.querySelector(`#replies-${postId}`);
        repliesContainer.style.display = (repliesContainer.style.display === 'none' || repliesContainer.style.display === '') ? 'block' : 'none';
    }
</script>
<!--     
    <ul>
        {% for post in all_posts %}
            <li>{{ post.post_header }} - {{ post.post_text }}</li>
           
            <form method="post" action="{% url 'recent_post' %}">
                {% csrf_token %}
                <label for="reply_text">Your Reply:</label>
                <textarea id="reply_text"  name="reply_text" required ></textarea>
                <button type="submit">Reply</button>
            </form>

        {% endfor %}
        
    </ul>

    


    <body>
        <h1>Create a New Post</h1>

        <form action="{% url 'recent_post' %}" method="POST"> 
            {% csrf_token %}
             <div class="form-group mt-2">
                <label>Public user name</label>
                <input type="text"  class="form-control" rows="5" id="public_user_name" name="header"><br>
                <label>Public question</label>
                <textarea type="text"  class="form-control" rows="5" id="public_post" name="post"></textarea>
             </div>
             <button type="submit" id="sendpost" class="btn btn-primary">Post</button>
         </form> -->


<script>
    $('#sendpost').click(function (event) {
        event.preventDefault();
        console.log("AA")
        $.ajax({
            url: "{% url 'recent_post' %}",
            type: "POST",
            data: {
                posttext: $('#new-post').val(),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },

            success: function (json) {
                console.log(json);
                location.reload()


            }
        });



    });
</script>
{% endblock %}