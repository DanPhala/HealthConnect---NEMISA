!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs"],o):(e=e||self).ChartZoom=o(e.Chart,e.Hammer)}(this,function(e,s){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s;var p=e.helpers,f=e.Zoom=e.Zoom||{},i=f.zoomFunctions=f.zoomFunctions||{},a=f.panFunctions=f.panFunctions||{};function v(e,o){var t={};void 0!==e.options.pan&&(t.pan=e.options.pan),void 0!==e.options.zoom&&(t.zoom=e.options.zoom);var n=e.$zoom;o=n._options=p.merge({},[o,t]);e=n._node,t=o.zoom&&o.zoom.enabled,o=o.zoom.drag;t&&!o?e.addEventListener("wheel",n._wheelHandler):e.removeEventListener("wheel",n._wheelHandler),t&&o?(e.addEventListener("mousedown",n._mouseDownHandler),e.ownerDocument.addEventListener("mouseup",n._mouseUpHandler)):(e.removeEventListener("mousedown",n._mouseDownHandler),e.removeEventListener("mousemove",n._mouseMoveHandler),e.ownerDocument.removeEventListener("mouseup",n._mouseUpHandler))}function h(t){var n=t.$zoom._originalOptions;p.each(t.scales,function(e){n[e.id]||(n[e.id]=p.clone(e.options))}),p.each(n,function(e,o){t.scales[o]||delete n[o]})}function x(e,o,t){return void 0===e||("string"==typeof e?-1!==e.indexOf(o):"function"==typeof e&&-1!==e({chart:t}).indexOf(o))}function c(e,o){return!e.scaleAxes||!e.rangeMax||p.isNullOrUndef(e.rangeMax[e.scaleAxes])||(e=e.rangeMax[e.scaleAxes])<o&&(o=e),o}function u(e,o){return!e.scaleAxes||!e.rangeMin||p.isNullOrUndef(e.rangeMin[e.scaleAxes])||o<(e=e.rangeMin[e.scaleAxes])&&(o=e),o}function m(e,o,t,n){var a=e.max-e.min,o=a*(o-1),t=e.isHorizontal()?t.x:t.y,t=(e.getValueForPixel(t)-e.min)/a,a=o*(1-t);e.options.ticks.min=u(n,e.min+o*t),e.options.ticks.max=c(n,e.max-a)}function d(e,o,t,n){var a=i[e.type];a&&a(e,o,t,n)}function g(o,t,n,a,e,i){var m=o.chartArea;a=a||{x:(m.left+m.right)/2,y:(m.top+m.bottom)/2};var l,r,s=o.$zoom._options.zoom;s.enabled&&(h(o),l="function"==typeof s.mode?s.mode({chart:o}):s.mode,r="xy"===l&&void 0!==e?e:"xy",p.each(o.scales,function(e){e.isHorizontal()&&x(l,"x",o)&&x(r,"x",o)?(s.scaleAxes="x",d(e,t,a,s)):!e.isHorizontal()&&x(l,"y",o)&&x(r,"y",o)&&(s.scaleAxes="y",d(e,n,a,s))}),i?o.update({duration:i,easing:"easeOutQuad"}):o.update(0),"function"==typeof s.onZoom&&s.onZoom({chart:o}))}function n(e,o,t){var n,a=e.options.ticks,i=e.min,m=e.max,l=e.getValueForPixel(e.getPixelForValue(i)-o),r=e.getValueForPixel(e.getPixelForValue(m)-o),e=l=l.valueOf?l.valueOf():l,o=r=r.valueOf?r.valueOf():r;t.scaleAxes&&t.rangeMin&&!p.isNullOrUndef(t.rangeMin[t.scaleAxes])&&(e=t.rangeMin[t.scaleAxes]),t.scaleAxes&&t.rangeMax&&!p.isNullOrUndef(t.rangeMax[t.scaleAxes])&&(o=t.rangeMax[t.scaleAxes]),e<=l&&r<=o?(a.min=l,a.max=r):l<e?(n=i-e,a.min=e,a.max=m-n):o<r&&(n=o-m,a.max=o,a.min=i+n)}function z(e,o,t){var n=a[e.type];n&&n(e,o,t)}e.Zoom.defaults=e.defaults.global.plugins.zoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1}},f.zoomFunctions.category=function(e,o,t,n){var a=e.chart.data.labels,i=e.minIndex,m=a.length-1,l=e.maxIndex,r=n.sensitivity,s=e.isHorizontal()?e.left+e.width/2:e.top+e.height/2,t=e.isHorizontal()?t.x:t.y;f.zoomCumulativeDelta=1<o?f.zoomCumulativeDelta+1:f.zoomCumulativeDelta-1,Math.abs(f.zoomCumulativeDelta)>r&&(f.zoomCumulativeDelta<0?(s<=t?i<=0?l=Math.min(m,l+1):i=Math.max(0,i-1):t<s&&(m<=l?i=Math.max(0,i-1):l=Math.min(m,l+1)),f.zoomCumulativeDelta=0):0<f.zoomCumulativeDelta&&(s<=t?i=i<l?Math.min(l,i+1):i:t<s&&(l=i<l?Math.max(i,l-1):l),f.zoomCumulativeDelta=0),e.options.ticks.min=u(n,a[i]),e.options.ticks.max=c(n,a[l]))},f.zoomFunctions.time=function(e,o,t,n){m(e,o,t,n);e=e.options;e.time&&(e.time.min&&(e.time.min=e.ticks.min),e.time.max&&(e.time.max=e.ticks.max))},f.zoomFunctions.linear=m,f.zoomFunctions.logarithmic=m,f.panFunctions.category=function(e,o,t){var n=e.chart.data.labels,a=n.length-1,i=Math.max(e.ticks.length,1),m=t.speed,l=e.minIndex,m=Math.round(e.width/(i*m));f.panCumulativeDelta+=o,l=f.panCumulativeDelta>m?Math.max(0,l-1):f.panCumulativeDelta<-m?Math.min(a-i+1,l+1):l,f.panCumulativeDelta=l!==e.minIndex?0:f.panCumulativeDelta,i=Math.min(a,l+i-1),e.options.ticks.min=u(t,n[l]),e.options.ticks.max=c(t,n[i])},f.panFunctions.time=function(e,o,t){n(e,o,t);e=e.options;e.time&&(e.time.min&&(e.time.min=e.ticks.min),e.time.max&&(e.time.max=e.ticks.max))},f.panFunctions.linear=n,f.panFunctions.logarithmic=n,f.panCumulativeDelta=0,f.zoomCumulativeDelta=0;var o={id:"zoom",afterInit:function(e){e.resetZoom=function(){h(e);var n=e.$zoom._originalOptions;p.each(e.scales,function(e){var o=e.options.time,t=e.options.ticks;n[e.id]?(o&&(o.min=n[e.id].time.min,o.max=n[e.id].time.max),t&&(t.min=n[e.id].ticks.min,t.max=n[e.id].ticks.max)):(o&&(delete o.min,delete o.max),t&&(delete t.min,delete t.max))}),e.update()}},beforeUpdate:function(e,o){v(e,o)},beforeInit:function(c,e){c.$zoom={_originalOptions:{}};var u=c.$zoom._node=c.ctx.canvas;v(c,e);var d=c.$zoom._options,o=d.pan&&d.pan.threshold;c.$zoom._mouseDownHandler=function(e){u.addEventListener("mousemove",c.$zoom._mouseMoveHandler),c.$zoom._dragZoomStart=e},c.$zoom._mouseMoveHandler=function(e){c.$zoom._dragZoomStart&&(c.$zoom._dragZoomEnd=e,c.update(0))},c.$zoom._mouseUpHandler=function(e){var o,t,n,a,i,m,l,r,s;c.$zoom._dragZoomStart&&(u.removeEventListener("mousemove",c.$zoom._mouseMoveHandler),i=(l=c.$zoom._dragZoomStart).target.getBoundingClientRect().left,o=Math.min(l.clientX,e.clientX)-i,m=Math.max(l.clientX,e.clientX)-i,r=l.target.getBoundingClientRect().top,t=Math.min(l.clientY,e.clientY)-r,n=m-o,a=Math.max(l.clientY,e.clientY)-r-t,c.$zoom._dragZoomStart=null,c.$zoom._dragZoomEnd=null,n<=(s=d.zoom&&d.zoom.threshold||0)&&a<=s||(i=c.chartArea,m=c.$zoom._options.zoom,l=i.right-i.left,e=x(m.mode,"x",c)&&n?1+(l-n)/l:1,r=i.bottom-i.top,s=x(m.mode,"y",c),g(c,e,s&&a?1+(r-a)/r:1,{x:(o-i.left)/(1-n/l)+i.left,y:(t-i.top)/(1-a/r)+i.top},void 0,m.drag.animationDuration),"function"==typeof m.onZoomComplete&&m.onZoomComplete({chart:c})))};var m,t,n,a,i,l,r=null;c.$zoom._wheelHandler=function(e){var o,t,n;e.cancelable&&e.preventDefault(),void 0!==e.deltaY&&(n=e.target.getBoundingClientRect(),o={x:e.clientX-n.left,y:e.clientY-n.top},n=(t=c.$zoom._options.zoom).speed,0<=e.deltaY&&(n=-n),g(c,1+n,1+n,o),clearTimeout(r),r=setTimeout(function(){"function"==typeof t.onZoomComplete&&t.onZoomComplete({chart:c})},250))},s&&((e=new s.Manager(u)).add(new s.Pinch),e.add(new s.Pan({threshold:o})),t=function(e){var o=1/m*e.scale,t=e.target.getBoundingClientRect(),n={x:e.center.x-t.left,y:e.center.y-t.top},a=Math.abs(e.pointers[0].clientX-e.pointers[1].clientX),i=Math.abs(e.pointers[0].clientY-e.pointers[1].clientY),t=a/i;g(c,o,o,n,.3<t&&t<1.7?"xy":i<a?"x":"y");a=c.$zoom._options.zoom;"function"==typeof a.onZoomComplete&&a.onZoomComplete({chart:c}),m=e.scale},e.on("pinchstart",function(){m=1}),e.on("pinch",t),e.on("pinchend",function(e){t(e),m=null,f.zoomCumulativeDelta=0}),a=n=null,i=!1,l=function(e){var o,t;null!==n&&null!==a&&(i=!0,o=e.deltaX-n,t=e.deltaY-a,n=e.deltaX,a=e.deltaY,function(o,t,n){h(o);var a,i=o.$zoom._options.pan;i.enabled&&(a="function"==typeof i.mode?i.mode({chart:o}):i.mode,p.each(o.scales,function(e){e.isHorizontal()&&x(a,"x",o)&&0!=t?(i.scaleAxes="x",z(e,t,i)):!e.isHorizontal()&&x(a,"y",o)&&0!=n&&(i.scaleAxes="y",z(e,n,i))}),o.update(0),"function"==typeof i.onPan&&i.onPan({chart:o}))}(c,o,t))},e.on("panstart",function(e){a=n=0,l(e)}),e.on("panmove",l),e.on("panend",function(){a=n=null,f.panCumulativeDelta=0,setTimeout(function(){i=!1},500);var e=c.$zoom._options.pan;"function"==typeof e.onPanComplete&&e.onPanComplete({chart:c})}),c.$zoom._ghostClickHandler=function(e){i&&e.cancelable&&(e.stopImmediatePropagation(),e.preventDefault())},u.addEventListener("click",c.$zoom._ghostClickHandler),c._mc=e)},beforeDatasetsDraw:function(a){var e,o,t,n,i,m,l,r,s=a.ctx;a.$zoom._dragZoomEnd&&(r=function(){for(var e=a.scales,o=Object.keys(e),t=0;t<o.length;t++){var n=e[o[t]];if(n.isHorizontal())return n}}(),t=function(){for(var e=a.scales,o=Object.keys(e),t=0;t<o.length;t++){var n=e[o[t]];if(!n.isHorizontal())return n}}(),e=a.$zoom._dragZoomStart,o=a.$zoom._dragZoomEnd,n=r.left,l=r.right,i=t.top,r=t.bottom,x(a.$zoom._options.zoom.mode,"x",a)&&(t=e.target.getBoundingClientRect().left,n=Math.min(e.clientX,o.clientX)-t,l=Math.max(e.clientX,o.clientX)-t),x(a.$zoom._options.zoom.mode,"y",a)&&(m=e.target.getBoundingClientRect().top,i=Math.min(e.clientY,o.clientY)-m,r=Math.max(e.clientY,o.clientY)-m),m=l-n,l=r-i,r=a.$zoom._options.zoom.drag,s.save(),s.beginPath(),s.fillStyle=r.backgroundColor||"rgba(225,225,225,0.3)",s.fillRect(n,i,m,l),0<r.borderWidth&&(s.lineWidth=r.borderWidth,s.strokeStyle=r.borderColor||"rgba(225,225,225)",s.strokeRect(n,i,m,l)),s.restore())},destroy:function(e){var o,t;e.$zoom&&((t=(o=e.$zoom)._node).removeEventListener("mousedown",o._mouseDownHandler),t.removeEventListener("mousemove",o._mouseMoveHandler),t.ownerDocument.removeEventListener("mouseup",o._mouseUpHandler),t.removeEventListener("wheel",o._wheelHandler),t.removeEventListener("click",o._ghostClickHandler),delete e.$zoom,(e=e._mc)&&(e.remove("pinchstart"),e.remove("pinch"),e.remove("pinchend"),e.remove("panstart"),e.remove("pan"),e.remove("panend"),e.destroy()))}};return e.plugins.register(o),o});